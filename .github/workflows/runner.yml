# This workflow runs all the rest of the workflows
name: ğŸ”— Builds
on:
    push:
      paths:
        - "**"
        - "!**.md"
        - "!LICENSE"
        - "!.scripts/clang_format.sh"
        - "!.github/**"
        - "!.vscode/**"
        - ".github/actions/**"
        - ".github/workflows/**"
    pull_request:
      paths:
        - "**"
        - "!**.md"
        - "!LICENSE"
        - "!.scripts/clang_format.sh"
        - "!.github/**"
        - "!.vscode/**"
        - ".github/actions/**"
        - ".github/workflows/**"

concurrency:
  group: ${{ github.ref }}
  cancel-in-progress: true

jobs:
  editor-builds:
    name: ğŸ¤– Build Godot for All Platforms
    uses: ./.github/workflows/all_editor_builds.yml
    secrets: inherit

  macos-plugin-builds:
    name: ğŸ Build Patchwork for macOS
    uses: ./.github/workflows/macos_builds.yml
    secrets: inherit

  windows-plugin-builds:
    name: ğŸªŸ Build Patchwork for Windows
    uses: ./.github/workflows/windows_builds.yml

  linux-plugin-builds:
    name: ğŸ§ Build Patchwork for Linux
    uses: ./.github/workflows/linux_builds.yml

  merge-plugin-builds:
    name: ğŸ§© Merge Patchwork Builds
    needs: [macos-plugin-builds, windows-plugin-builds, linux-plugin-builds]
    uses: ./.github/workflows/merge_builds.yml

  compose-projects:
    name: ğŸ§µ Compose Projects
    needs: [merge-plugin-builds]
    uses: ./.github/workflows/compose_projects.yml

  prepare-composite:
    name: ğŸš€ Prepare Windows-Ready Projects
    # if: github.ref_type == 'tag'
    needs: [compose-projects, editor-builds]
    uses: ./.github/workflows/prepare_composite.yml

  release:
    name: ğŸ“¦ Release
    if: github.ref_type == 'tag'
    needs: [editor-builds, merge-plugin-builds, compose-projects, prepare-composite]
    uses: ./.github/workflows/release.yml