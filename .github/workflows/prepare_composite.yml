name: ðŸš€ Prepare Windows-Ready Projects
on:
  workflow_call:

jobs:
  # Endless has requested a special version of moddable-platformer with:
  # 1. Patchwork installed
  # 2. Godot for Windows installed in godot_editor/
  # 3. Launch and update scripts from LilithSilver/patchwork-update-script
  # moddable-platformer-with-patchwork already provides 1, so we just need to handle 2 and 3
  prepare-moddable-platformer-composite:
    runs-on: ubuntu-latest
    name: ðŸš€ Prepare Windows-Ready Projects
    steps:
      - name: Acquire moddable-platformer-with-patchwork
        uses: actions/download-artifact@v4
        with:
          name: moddable-platformer-with-patchwork
          path: ${{ github.workspace }}/moddable-platformer
      - name: Acquire godot-windows
        uses: actions/download-artifact@v4
        with:
          name: godot-with-patchwork-windows
          path: ${{ github.workspace }}/godot-with-patchwork-windows
      - name: Copy Godot into moddable-platformer
        run: |
          mkdir moddable-platformer/godot_editor
          cp godot-with-patchwork-windows/* moddable-platformer/godot_editor
      - name: Checkout update scripts
        uses: actions/checkout@v6
        with:
          fetch-depth: 0
          path: patchwork-update-script
          repository: LilithSilver/patchwork-update-script
      - name: Copy batch and ps1 files
        run: cp patchwork-update-script/*.{cmd,ps1} moddable-platformer
      - name: Merge .gitignore
        run: cat patchwork-update-script/.gitignore >> moddable-platformer/.gitignore
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: moddable-platformer-windows-ready
          path: moddable-platformer/*
          if-no-files-found: error
